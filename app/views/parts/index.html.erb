<!-- app/views/parts/index.html.erb -->
<h1 class="mb-4">Parts List</h1>

<div class="mb-3">
  <input type="text" id="search" class="form-control" placeholder="Search parts...">
</div>

<div class="mb-3">
  <h5>Price Range</h5>
  <select id="filter-price" class="form-control">
    <option value="">Select Price Range</option>
    <option value="0-100">0 - 100</option>
    <option value="101-200">101 - 200</option>
    <option value="201-300">201 - 300</option>
    <option value="301-400">301 - 400</option>
    <option value="401-500">401 - 500</option>
  </select>
</div>

<div class="mb-3">
  <%= form_with url: import_parts_path, local: true, method: :post, html: { multipart: true } do %>
    <%= file_field_tag :file %>
    <%= submit_tag 'Import Parts', class: 'btn btn-primary' %>
  <% end %>
</div>

<div class="mb-3">
  <%= link_to 'Export Parts', export_parts_path, class: 'btn btn-success' %>
  <%= link_to 'Download Export', download_export_parts_path, class: 'btn btn-info' %>
</div>
<% if flash[:alert] %>
  <div class="alert alert-danger"><%= flash[:alert] %></div>
<% end %>
<% if flash[:notice] %>
  <div class="alert alert-success"><%= flash[:notice] %></div>
<% end %>

<!-- <div class="mb-3">
  <h5>Categories</h5>
  <div>
    <label><input type="checkbox" class="filter-category" value="Category1"> Category 1</label><br>
    <label><input type="checkbox" class="filter-category" value="Category2"> Category 2</label><br>
    <label><input type="checkbox" class="filter-category" value="Category3"> Category 3</label><br>
  </div>
</div> -->

<div id="part-list" class="table-responsive">
  <table class="table table-striped">
    <tbody>
      <%= render partial: 'parts/part_list', locals: { parts: @parts } %>
    </tbody>
  </table>
</div>

<div class="my-3">
  <%= link_to 'New Part', new_part_path, class: 'btn btn-success' %>
  <%= link_to 'Order List', orders_path, class: 'btn btn-secondary' %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search');
    const priceFilter = document.getElementById('filter-price');
    const categoryFilters = document.querySelectorAll('.filter-category');

    const fetchParts = () => {
      const query = searchInput.value;
      const priceRange = priceFilter.value;
      const selectedCategories = Array.from(categoryFilters)
        .filter(checkbox => checkbox.checked)
        .map(checkbox => checkbox.value);

      // Construct the query string
      let url = `/parts/search?q[item_part_number_or_part_number_or_name_or_description_cont]=${query}`;
      if (priceRange) {
        const [minPrice, maxPrice] = priceRange.split('-');
        url += `&q[price_gteq]=${minPrice}&q[price_lteq]=${maxPrice}`;
      }
      if (selectedCategories.length > 0) {
        url += `&q[category_in]=${selectedCategories.join(',')}`; // Assumes you have a category attribute
      }

      fetch(url)
        .then(response => response.text())
        .then(html => {
          document.getElementById('part-list').innerHTML = html;
        });
    };

    searchInput.addEventListener('input', fetchParts);
    priceFilter.addEventListener('change', fetchParts);
    categoryFilters.forEach(checkbox => {
      checkbox.addEventListener('change', fetchParts);
    });
  });
</script>